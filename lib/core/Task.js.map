{"version":3,"sources":["../../src/core/Task.js"],"names":["Task","task","description","timings","t","stop","diff","start","time","operation","timing","length","newStop","value","momentKey","isBefore","Promise","resolve","reject","started","error","push","toDate","setDescription","setStatus","log","toISOString","text","status","stringTime","parsed","map","_modifyTiming","err","console","duration","forEach","_calcTime"],"mappings":"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","file":"Task.js","sourcesContent":["import moment from 'moment'\n\nimport { STARTED, PAUSED, IN_PROGRESS, FINISHED } from './constants'\nimport { recognizeModifierTiming } from './utils'\nimport { cliError } from './output'\n\n\nexport default class Task {\n    constructor(task){\n        this.task = (task) ? task : {\n            description: '',\n            timings: []\n        }\n    }\n\n    _calcTime(t){\n        if (t.stop) {\n            return moment(t.stop).diff(moment(t.start), 'seconds')\n        } else {\n            return moment().diff(moment(t.start), 'seconds')\n        }\n    }\n\n    _modifyTiming(time, operation){\n        let timing = this.task.timings[this.task.timings.length - 1]\n        if (!timing){\n            throw (`This task is not started, start it.`)\n        }\n\n        let newStop = moment(timing.stop)\n        newStop = newStop[operation](time.value, time.momentKey)\n\n        if (operation === 'subtract' && newStop.isBefore(timing.start)){\n            throw('You cant subtract more time')\n            return\n        }\n\n        this.task.timings[this.task.timings.length - 1].stop = newStop\n    }\n\n    start(description){\n        return new Promise((resolve, reject)=>{\n            let started = false\n\n            let timing = this.task.timings[this.task.timings.length - 1]\n\n            if (timing && timing.start && !timing.stop) {\n                reject(this.error(`This task already started.`))\n            }\n\n            this.task.timings.push({\n                start: moment().toDate()\n            })\n\n            this.setDescription(description)\n            this.setStatus(IN_PROGRESS)\n            this.log('start')\n            resolve()\n        })\n    }\n\n    pause(){\n        return new Promise((resolve, reject)=>{\n            let timing = this.task.timings[this.task.timings.length - 1]\n\n            if (!timing){\n                reject(this.error(`This task is not started, start it.`))\n            }\n\n            if (timing && timing.start && timing.stop) {\n                reject(this.error(`This task are ended/paused, unpaused it.`))\n            }\n\n            this.task.timings[this.task.timings.length - 1].stop = moment().toDate()\n            this.setStatus(PAUSED)\n            this.log('pause')\n            resolve()\n        })\n    }\n\n    unpause(){\n        return new Promise((resolve, reject)=>{\n            let timing = this.task.timings[this.task.timings.length - 1]\n            if (!timing){\n                reject(this.error(`This task is not started, start it`))\n            }\n\n            if (timing && timing.start && !timing.stop) {\n                reject(this.error(`This task is started, pause/stop first`))\n            }\n\n            this.task.timings.push({\n                start: moment().toDate()\n            })\n            this.setStatus(IN_PROGRESS)\n            this.log('unpause')\n            resolve()\n        })\n    }\n\n    stop (description){\n        return new Promise((resolve, reject)=>{\n            let timing = this.task.timings[this.task.timings.length - 1]\n            if (!timing || timing && !timing.start){\n                reject(this.error(`This task is not started, start it`))\n            }\n\n            if (timing.start && timing.stop) {\n                reject(this.error(`This task already ended, start/unpause it.`))\n            }\n\n            this.task.timings[this.task.timings.length - 1].stop = moment().toDate()\n            this.setDescription(description)\n            this.setStatus(FINISHED)\n            this.log('stop')\n            resolve()\n        })\n    }\n\n    log(operation){\n        if (!this.task.log){\n            this.task.log = []\n        }\n\n        this.task.log.push(`${operation}#${moment().toISOString()}`)\n    }\n\n    description(){\n        return this.task.description\n    }\n\n    setDescription(text){\n        this.task.description = (text) ? text : (this.task.description) ? this.task.description : ''\n    }\n\n    setStatus(status){\n        this.task.status = status\n    }\n\n    makeOperationOverTime(operation, stringTime) {\n        return new Promise((resolve, reject) => {\n            let parsed = recognizeModifierTiming(stringTime)\n\n            try {\n                parsed.map((t)=>{\n                    this._modifyTiming(t, operation)\n                })\n            } catch(err){\n                console.error(err)\n                reject(this.error(`Error trying to ${operation} time to task`))\n            }\n            this.log(`${operation}:${stringTime}`)\n\n            resolve()\n        })\n    }\n\n    get(){\n        return this.task\n    }\n\n    getSeconds(){\n        let duration = 0\n\n        if (this.task.timings){\n            this.task.timings.forEach(timing => {\n                duration += this._calcTime(timing)\n            })\n        } else {\n            duration = this._calcTime(this.task)\n        }\n\n        return duration\n    }\n\n    getStartDate(){\n        if (this.task.timings){\n            return this.task.timings[0].start\n        } else {\n            return this.task.start\n        }\n    }\n\n    error(err){\n        return err //+ ` \\n Task: ${JSON.stringify(this.task)}`\n    }\n}\n"]}